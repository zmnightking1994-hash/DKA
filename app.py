import streamlit as st

# --- ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ ---
st.set_page_config(page_title="BSPED DKA Manager", layout="wide", page_icon="๐ฉบ")

# --- ูุงุฌูุฉ ุงูุชุทุจูู ุงูุฑุฆูุณูุฉ ---
st.title("๐ฉบ ุชุทุจูู ุงูุชุฏุจูุฑ ุงููุซุงูู ููุญูุงุถ ุงูููุชููู ุงูุณูุฑู (DKA)")
st.markdown("##### ูุณุชูุญู ูู ุฏููู ุฌูุนูุฉ BSPED 2021/2024 ููุฃุทูุงู ูุงููุฑุงูููู")

# --- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ูููุฏุฎูุงุช ---
with st.sidebar:
    st.header("๐ฅ ุฅุฏุฎุงู ุงูุจูุงูุงุช")
    weight = st.number_input("ุงููุฒู (ูุฌู)", min_value=1.0, max_value=150.0, value=20.0, step=0.1)
    ph = st.number_input("ูููุฉ ุงูู pH ุงูุฃููู", min_value=6.7, max_value=7.5, value=7.1, step=0.01)
    current_bg = st.number_input("ูุณุชูู ุงูุณูุฑ ุงูุญุงูู (mmol/L)", min_value=0.0, value=20.0, step=0.1)
    bolus_given = st.number_input("ุณูุงุฆู ุงูุฅูุนุงุด ุงููุนุทุงุฉ ุณุงุจูุงู (ml)", min_value=0, value=0, help="ุฃู ุณูุงุฆู ูุฑูุฏูุฉ ุณุฑูุนุฉ ุฃูุนุทูุช ูุจู ุงูุจุฏุก ุจุงูุจุฑูุชูููู")
    
    st.divider()
    insulin_option = st.select_slider("ูุนุฏู ุงูุฃูุณูููู (Units/kg/hr)", options=[0.05, 0.1], value=0.1)
    
    st.info("๐ก ูุชู ุชุนููุถ ุงูุนุฌุฒ ุนูู ูุฏุงุฑ 48 ุณุงุนุฉ ุญุณุจ ุชูุตูุงุช BSPED.")

# --- ููุทู ุงูุญุณุงุจุงุช ุงูุทุจูุฉ (ุญุณุจ ุงูุฏููู ุงููุฑูู) ---

# 1. ุชุญุฏูุฏ ุงูุดุฏุฉ ููุณุจุฉ ุงูุฌูุงู ุจูุงุกู ุนูู pH
if ph < 7.1:
    dehydration, severity = 10.0, "Severe (ุดุฏูุฏ)"
elif ph < 7.2:
    dehydration, severity = 5.0, "Moderate (ูุชูุณุท)"
else:
    dehydration, severity = 5.0, "Mild (ุฎููู)"

# 2. ุญุณุงุจ ุณูุงุฆู ุงูุฅูุงูุฉ (Maintenance) - ูุงุนุฏุฉ BSPED ุงููุญุฏุซุฉ (2/0.5/0.2)
def calc_hydration(w):
    if w <= 10:
        rate = w * 2
    elif w <= 20:
        rate = 20 + (w - 10) * 0.5
    else:
        rate = 25 + (w - 20) * 0.2
    return min(rate, 80) # ุงูุญุฏ ุงูุฃูุตู ููุฅูุงูุฉ 80 ูู/ุณุงุนุฉ

hydration_rate = calc_hydration(weight)

# 3. ุญุณุงุจ ุงูุนุฌุฒ (Deficit) ุงููุทุฑูุญ ููู ุงูุจููุณ ูููุณู ุนูู 48 ุณุงุนุฉ
total_deficit_vol = (dehydration * weight * 10) - bolus_given
hourly_deficit_rate = total_deficit_vol / 48

# 4. ุงููุฌููุน ุงูููู ููุนุฏู ุงูุฃูุณูููู
total_hourly_rate = hydration_rate + hourly_deficit_rate
insulin_hourly = weight * insulin_option

# --- ุนุฑุถ ุงููุชุงุฆุฌ ุงูุฑุฆูุณูุฉ ---
col1, col2, col3 = st.columns(3)

with col1:
    st.metric("ุดุฏุฉ ุงูุญุงูุฉ", severity)
    st.metric("ูุณุจุฉ ุงูุฌูุงู", f"{dehydration}%")

with col2:
    st.metric("ุณูุงุฆู ุงูุฅูุงูุฉ", f"{hydration_rate:.2f} ml/hr")
    st.metric("ุชุนููุถ ุงูุนุฌุฒ", f"{hourly_deficit_rate:.2f} ml/hr")

with col3:
    st.success("ุงููุนุฏู ุงูููู ููุฌุฑูุงู")
    st.title(f"{total_hourly_rate:.2f}")
    st.caption("ูู/ุณุงุนุฉ (ml/hr)")

st.divider()

# --- ููุทู ุงูุฌููููุฒ ุงููุชุบูุฑ ูุชูุตูุฉ ุงููุญููู ---
st.subheader("๐งช ููุน ุงููุญููู ูุงูุชูุตูุฉ ุงูุญุงููุฉ")
c_logic1, c_logic2 = st.columns([2, 1])

with c_logic1:
    if current_bg > 14:
        st.info(f"**ุงููุญููู ุงููุทููุจ:** Plasma-Lyte 148 ุฃู NaCl 0.9% (ุจุฏูู ุฌููููุฒ).")
        st.write("๐ ูุฌุจ ุฅุถุงูุฉ **40 mmol/L** ูู ุงูุจูุชุงุณููู ููู ููุณ ุณูุงุฆู.")
    elif 6 <= current_bg <= 14:
        st.warning(f"**ุชุบููุฑ ุงููุญููู:** ุฃุถู **5% ุฌููููุฒ** ูููุญููู ุงููุฑูุฏู ุงูุญุงูู (Plasma-Lyte ุฃู NaCl 0.9%).")
        st.write("๐ ุงุณุชูุฑ ูู ุฅุถุงูุฉ ุงูุจูุชุงุณููู ุจุชุฑููุฒ 40 mmol/L.")
    else:
        st.error(f"**ุชูุจูู ูุจูุท ุณูุฑ:** ุงุณุชุฎุฏู ูุญููู ูุญุชูู ุนูู **10% ุฌููููุฒ**.")
        st.write("๐จ ุงุชุจุน ุจุฑูุชูููู ุนูุงุฌ ุงููุจูุท ุงูุญุงุฏ ุฅุฐุง ูู ุงูุณูุฑ ุนู 4 mmol/L.")

with c_logic2:
    st.metric("ูุนุฏู ุชุณุฑูุจ ุงูุฃูุณูููู", f"{insulin_hourly:.2f} U/hr")
    st.caption("ูุจุฏุฃ ุงูุฃูุณูููู ุจุนุฏ 1-2 ุณุงุนุฉ ูู ุจุฏุก ุงูุณูุงุฆู.")

st.divider()

# --- ููุงุฆู ุงููุฑุงูุจุฉ ุงูุณุฑูุฑูุฉ ---
col_obs1, col_obs2 = st.columns(2)

with col_obs1:
    st.subheader("๐จ ูุฑุงูุจุฉ ูุฐูุฉ ุงูุฏูุงุบ (ูู ุณุงุนุฉ)")
    st.checkbox("ูู ููุฌุฏ ุตุฏุงุน ุดุฏูุฏ ุฃู ูุชุฒุงูุฏุ")
    st.checkbox("ูู ููุงู ุงูุฎูุงุถ ูู ูุณุชูู ุงููุนู (GCS)ุ")
    st.checkbox("ูู ููุงู ุชุจุงุทุค ูู ูุจุถ ุงูููุจ (Bradycardia)ุ")
    st.write("โ๏ธ *ุฅุฐุง ุชู ุชุญุฏูุฏ ุฃู ููุง ุณุจูุ ููุฑ ูู ุงููุงููุชูู ููุฑุงู.*")

with col_obs2:
    st.subheader("โ ุนูุงูุงุช ุชุญุณู ุงูุญุงูุฉ (Resolution)")
    st.checkbox("ุงูู pH > 7.3")
    st.checkbox("ุงูููุชููุงุช ูู ุงูุฏู < 1.0 mmol/L")
    st.checkbox("ุงูุทูู ูุงุฏุฑ ุนูู ุงูุดุฑุจ ูุงูุฃูู ุจุดูู ุฌูุฏ")
    st.write("๐ก *ุนูุฏ ุชุญูู ูุฐู ุงูุดุฑูุทุ ุงุจุฏุฃ ุงูุฃูุณูููู ุชุญุช ุงูุฌูุฏ ุซู ุฃููู ุงููุฑูุฏู ุจุนุฏ ุณุงุนุฉ.*")

# --- ุชุฐููู ุงูุตูุญุฉ ูุฅุฎูุงุก ุงููุณุคูููุฉ ---
st.divider()
st.caption("""
**ุฅุฎูุงุก ูุณุคูููุฉ:** ูุฐุง ุงูุชุทุจูู ุฃุฏุงุฉ ูุณุงุนุฏุฉ ููุนูููุงุช ุงูุญุณุงุจูุฉ ุงูุทุจูุฉ ุจูุงุกู ุนูู ุจุฑูุชูููู BSPED 2024. 
ูุง ูุบูู ูุฐุง ุงูุชุทุจูู ุนู ุงูุชูููู ุงูุณุฑูุฑู ุงููุจุงุดุฑ ููุฑุงุฑ ุงูุทุจูุจ ุงููุฎุชุต. 
ูุฌุจ ูุฑุงูุจุฉ ุงููุฑูุถ ุจุฏูุฉ ูุชุฌูุจ ูุถุงุนูุงุช ูุฐูุฉ ุงูุฏูุงุบ.
""")
